


从0开始

找不到原因也找不到解决方法的时候，我决定从0开始，从最最简单的demo开始，再试试会不会也会有问题。  

神奇的是，demo能跑起来，能成功Fix并且不黑屏，顿时看到了希望，因为demo非常非常简单，直接aar引用，也并没有去添加so库，也没有写什么下载patch什么的各种功能，那么问题就出现在我集成到项目中的过程中哪里出错了。  

思来想去，最后想想难道是线程问题？项目中我下载patch，addPatch是放在IntentService中去执行的，而demo里是直接主线程做的，难道真是线程的问题？

于是，我把`addPatch`放主线程里去，呵，一切都OK了！！！

AndFix中并没有提到这个，而我看这些操作都涉及到File，都是io流操作，非常本能的把这些操作都放到异步操作里去了，而且在我自己的手机上是OK的，所以从头至尾都没有考虑到线程这一块(没想到这么好的习惯也会有被坑的时候，表示无奈)  


至此，所有暂时遇到的问题都解决了  
总结一下使用AndFix需要注意的地方：
  
1. 合理封装，再包一层  
2. PatchManager保持单例  
3. 初始化PatchManager的Context要用ApplicationContext  
4. patch文件后缀为`.apatch`  
5. patch文件记得用MD5校验
6. 一个版本只有patch文件  
7. 当App升级AndFix会自动删除原有的apath文件，不需要自己动手     
8. 合理使用`try catch`来降低AndFix带来的crash概率  
9. 在使用AndFix的catch块里上报所有的错误，以便观察    
10. `PatchManager.addPatch(path)`要在主线程调用
11. 不能对同一个方法修复两次，否则App根本跑不起来     
12. aar只有arm，x86的so库，想要兼容更多平台，需要自己再添加相应的so库  
13. 多看看它源码  
14. 多搜索，多问人，耐心，冷静，自信      
15. 暂时没想到，就这样吧  


热修复的功能，算是完成了，也顺利地随着这个版本上线。  

虽然为了这功能折腾了挺久，也付出了不少，但是我希望，我永远不要用到它。  


